{{/* compose_command_preview.html - Natural language command result modal */}}
<dialog id="command-modal" open>
	<article>
		<header>
			<h3>Command Preview</h3>
			<form method="dialog" style="margin: 0;">
				<button class="modal-close" aria-label="Close">Ã—</button>
			</form>
		</header>

		{{if .HasChanges}}
		<div style="margin-bottom: 1rem;">
			<strong>Command:</strong> {{.Command}}
		</div>

		<div style="margin-bottom: 1rem;">
			<strong>Proposed Changes:</strong>
			<ul style="margin-top: 0.5rem;">
				{{range .Diff.Changes}}
				<li style="font-size: 0.875rem;">{{.}}</li>
				{{end}}
			</ul>
		</div>

		<details style="margin-bottom: 1rem;">
			<summary><strong>View Full Diff</strong></summary>
			<div style="margin-top: 0.75rem;">
				<h4 style="font-size: 0.9rem; margin-bottom: 0.5rem;">Before:</h4>
				<pre style="background: color-mix(in srgb, var(--pico-muted-border-color) 30%, transparent); padding: 0.75rem; border-radius: 0.25rem; overflow-x: auto; font-size: 0.75rem;"><code>{{.Diff.OldPreview}}</code></pre>
				
				<h4 style="font-size: 0.9rem; margin-bottom: 0.5rem; margin-top: 1rem;">After:</h4>
				<pre style="background: color-mix(in srgb, var(--pico-muted-border-color) 30%, transparent); padding: 0.75rem; border-radius: 0.25rem; overflow-x: auto; font-size: 0.75rem;"><code>{{.Diff.NewPreview}}</code></pre>
			</div>
		</details>

		<footer style="display: flex; gap: 0.5rem; justify-content: flex-end;">
			<form method="dialog" style="display: inline; margin: 0;">
				<button type="submit" class="secondary">
					Cancel
				</button>
			</form>
			<form hx-post="/compose/apply?workspace={{$.DirName}}" method="POST" style="display: inline; margin: 0;">
				<input type="hidden" name="newState" value='{{.NewState | printf "%#v"}}'>
				<button type="submit">
					Apply Changes
				</button>
			</form>
		</footer>

		{{else}}
		<div style="padding: 2rem; text-align: center; color: var(--pico-muted-color);">
			<p>No changes detected from command: <strong>{{.Command}}</strong></p>
			<p style="font-size: 0.875rem; margin-top: 0.5rem;">The LLM may not have understood the command or it resulted in no modifications.</p>
		</div>
		<footer style="display: flex; justify-content: flex-end;">
			<form method="dialog" style="margin: 0;">
				<button type="submit">
					Close
				</button>
			</form>
		</footer>
		{{end}}
	</article>
</dialog>
