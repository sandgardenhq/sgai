<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="color-scheme" content="light">
	<title>Retrospective Analysis - {{.SessionID}} - Sandgarden AI Software Factory</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
	<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js" integrity="sha384-/TgkGk7p307TH7EXJDuUlgG3Ce1UVolAOFopFekQkkXihi5u/6OCvVKyz1W+idaz" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/idiomorph@0.3.0/dist/idiomorph-ext.min.js"></script>
	<style>
		.retro-analyze-container {
			max-width: 1200px;
			margin: 0 auto;
		}
		.retro-analyze-header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			margin-bottom: 1rem;
			flex-wrap: wrap;
			gap: 1rem;
		}
		.retro-analyze-header h2 {
			margin: 0;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			max-width: 70%;
		}
		.header-right {
			display: flex;
			align-items: center;
			gap: 0.75rem;
			flex-shrink: 0;
		}
		.header-right form {
			margin: 0;
			display: inline-flex;
			flex-shrink: 0;
		}
		.header-right button {
			margin: 0;
		}
		.header-right .action-btn {
			padding: 0.4rem 0.75rem;
			font-size: 0.75rem;
			white-space: nowrap;
		}
		.status-badge {
			font-size: 0.75rem;
			padding: 0.4rem 0.75rem;
			border-radius: 4px;
			font-weight: 500;
			display: inline-flex;
			align-items: center;
			gap: 0.4rem;
			flex-shrink: 0;
		}
		.status-badge.running {
			background: color-mix(in srgb, var(--pico-primary) 20%, transparent);
			color: var(--pico-primary);
		}
		.status-badge.complete {
			background: color-mix(in srgb, #22c55e 20%, transparent);
			color: #16a34a;
		}
		.status-spinner {
			width: 12px;
			height: 12px;
			border: 2px solid currentColor;
			border-top-color: transparent;
			border-radius: 50%;
			animation: spin 1s linear infinite;
		}
		@keyframes spin {
			to { transform: rotate(360deg); }
		}
		.analyze-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 1rem;
		}
		@media (max-width: 768px) {
			.analyze-grid {
				grid-template-columns: 1fr;
			}
		}
		.analyze-section {
			min-height: 300px;
			max-height: calc(100vh - 250px);
			display: flex;
			flex-direction: column;
			padding: 0;
		}
		.analyze-section header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 1rem 1rem 0.75rem 1rem;
			background: var(--pico-card-background-color);
			flex-shrink: 0;
		}
		.analyze-section header h4 {
			margin: 0;
		}
		.analyze-section-content {
			flex: 1;
			overflow-y: auto;
			padding: 0 1rem 1rem 1rem;
		}
		.events-log {
			display: flex;
			flex-direction: column;
			gap: 0;
		}
		.event-date-divider {
			display: flex;
			align-items: center;
			gap: 0.75rem;
			padding: 0.75rem 0 0.5rem 0;
			margin-left: calc(0.75rem + 6px);
		}
		.event-date-divider span {
			font-size: 0.75rem;
			font-weight: 600;
			color: var(--pico-muted-color);
			text-transform: uppercase;
			letter-spacing: 0.05em;
			background: var(--pico-background-color);
			padding: 0.25rem 0.75rem;
			border-radius: 12px;
			border: 1px solid var(--pico-muted-border-color);
		}
		.event-entry {
			display: flex;
			gap: 0.75rem;
			padding: 0.35rem 0;
		}
		.event-timeline {
			display: flex;
			flex-direction: column;
			align-items: center;
			width: 12px;
			flex-shrink: 0;
			padding-top: 0.35rem;
		}
		.event-dot {
			width: 8px;
			height: 8px;
			border-radius: 50%;
			background: var(--pico-primary);
			flex-shrink: 0;
			box-shadow: 0 0 0 3px color-mix(in srgb, var(--pico-primary) 20%, transparent);
		}
		.event-line {
			width: 2px;
			flex: 1;
			min-height: 20px;
			background: var(--pico-muted-border-color);
			margin-top: 4px;
		}
		.event-entry:last-child .event-line {
			display: none;
		}
		.event-content {
			flex: 1;
			min-width: 0;
			padding-bottom: 0.5rem;
		}
		.event-meta {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			margin-bottom: 0.25rem;
			flex-wrap: wrap;
		}
		.event-meta time {
			font-size: 0.75rem;
			color: var(--pico-muted-color);
			white-space: nowrap;
		}
		.event-meta mark {
			font-size: 0.7rem;
			padding: 0.15rem 0.4rem;
			border-radius: 4px;
			background: color-mix(in srgb, var(--pico-primary) 15%, transparent);
			color: var(--pico-primary);
			font-weight: 500;
			max-width: 240px;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		.event-description {
			font-size: 0.875rem;
			color: var(--pico-color);
			line-height: 1.4;
			word-break: break-word;
		}
		.log-container {
			display: flex;
			flex-direction: column;
			height: 100%;
		}
		.log-lines {
			font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
			font-size: 0.8rem;
			line-height: 1.4;
			white-space: pre-wrap;
			word-break: break-all;
			flex: 1;
		}
		.log-line {
			padding: 0.15rem 0.25rem;
			border-bottom: 1px solid color-mix(in srgb, var(--pico-muted-border-color) 30%, transparent);
		}
		.log-line:last-child {
			border-bottom: none;
		}
		.log-line:nth-child(odd) {
			background: color-mix(in srgb, var(--pico-muted-border-color) 10%, transparent);
		}
		.empty-state {
			display: flex;
			align-items: center;
			justify-content: center;
			flex: 1;
			min-height: 150px;
			color: var(--pico-muted-color);
			font-style: italic;
		}
		.back-button-container {
			margin-top: 1.5rem;
			text-align: center;
		}
		.htmx-request .status-spinner {
			display: inline-block;
		}
		.improvements-preview {
			font-size: 0.875rem;
			line-height: 1.6;
		}
		.improvements-preview h1,
		.improvements-preview h2,
		.improvements-preview h3 {
			margin-top: 1rem;
			margin-bottom: 0.5rem;
		}
		.improvements-preview h1 { font-size: 1.25rem; }
		.improvements-preview h2 { font-size: 1.1rem; }
		.improvements-preview h3 { font-size: 1rem; }
		.improvements-preview ul,
		.improvements-preview ol {
			padding-left: 1.5rem;
			margin: 0.5rem 0;
		}
		.improvements-preview p {
			margin: 0.5rem 0;
		}
	</style>
</head>
<body hx-ext="morph">
	<main class="container retro-analyze-container">
		<nav>
			<ul>
				<li><a href="/workspaces/{{.WorkspaceID}}/retro?session={{.SessionID}}">&larr; Back to Session</a></li>
			</ul>
			<ul>
				<li><strong>Retrospective Analysis</strong></li>
			</ul>
		</nav>

		<div id="analyze-content"
			 hx-get="/workspaces/{{.WorkspaceID}}/retro/{{.SessionID}}/analyze/status"
			 hx-trigger="every 2s"
			 hx-swap="morph:innerHTML">
			{{template "retro_analyze_status.html" .}}
		</div>
	</main>
</body>
</html>
