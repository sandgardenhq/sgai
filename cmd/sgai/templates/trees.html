<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="color-scheme" content="light">
	<title>Sandgarden AI Software Factory</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
	<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js" integrity="sha384-/TgkGk7p307TH7EXJDuUlgG3Ce1UVolAOFopFekQkkXihi5u/6OCvVKyz1W+idaz" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/idiomorph@0.3.0/dist/idiomorph-ext.min.js"></script>
	<style>
		.tree-container {
			display: flex;
			gap: 0;
			height: calc(100vh - 38px);
			overflow: visible;
		}
		.tree-panel {
			width: 280px;
			min-width: 240px;
			max-width: 320px;
			overflow-y: auto;
			border-right: 1px solid var(--pico-muted-border-color);
			padding-right: 1rem;
			padding-left: 0.5rem;
			position: relative;
		}
		.log-panel {
			flex: 1;
			overflow: auto;
			padding-left: 1rem;
		}

		/* jj log visualization styles */
		.jj-log-article {
			padding: 0.5rem;
			margin: 0;
			background: transparent;
			border: none;
			box-shadow: none;
		}
		.jj-empty {
			padding: 2rem;
			text-align: center;
			color: var(--pico-muted-color);
			font-style: italic;
		}
		.jj-log {
			font-family: inherit;
			font-size: 0.9rem;
			line-height: 1.6;
		}
		.jj-commit {
			display: grid;
			grid-template-columns: auto 1fr;
			gap: 0;
			padding: 0.2rem 0.5rem;
			margin: 0 -0.5rem;
			border-radius: 8px;
			transition: all 0.15s ease;
			align-items: start;
		}
		.jj-commit:hover {
			background-color: color-mix(in srgb, var(--pico-muted-border-color) 50%, transparent);
		}
		.jj-commit.current {
			background: linear-gradient(135deg,
				color-mix(in srgb, var(--pico-primary) 15%, transparent) 0%,
				color-mix(in srgb, var(--pico-primary) 8%, transparent) 100%);
			border-left: 3px solid var(--pico-primary);
			margin-left: calc(-0.5rem - 3px);
			padding-left: calc(0.5rem + 3px);
			border-radius: 0 8px 8px 0;
		}
		.jj-graph-tree {
			display: flex;
			flex-direction: column;
			align-items: flex-start;
			padding-right: 0.5rem;
			min-width: 3rem;
		}
		.jj-graph-pre {
			font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
			font-size: 0.9rem;
			line-height: 1.6;
			margin: 0;
			padding: 0;
			background: transparent;
			color: var(--pico-muted-color);
			white-space: pre;
		}
		.jj-commit.current .jj-graph-pre {
			color: var(--pico-primary);
			font-weight: 600;
		}
		.jj-content {
			flex: 1;
			padding: 0 0.75rem;
			min-width: 0;
		}
		.jj-meta {
			display: flex;
			flex-wrap: wrap;
			align-items: center;
			gap: 0.5rem;
			line-height: 1.8;
		}
		.jj-change-id {
			font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
			font-size: 0.75rem;
			font-weight: 600;
			letter-spacing: 0.02em;
			padding: 0.2rem 0.5rem;
			background: linear-gradient(135deg,
				color-mix(in srgb, var(--pico-primary) 18%, transparent) 0%,
				color-mix(in srgb, var(--pico-primary) 10%, transparent) 100%);
			color: var(--pico-primary);
			border-radius: 4px;
			border: 1px solid color-mix(in srgb, var(--pico-primary) 25%, transparent);
		}
		.jj-commit-id {
			font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
			font-size: 0.7rem;
			padding: 0.15rem 0.4rem;
			color: var(--pico-muted-color);
			background: color-mix(in srgb, var(--pico-muted-border-color) 40%, transparent);
			border-radius: 3px;
		}
		.jj-workspace-badge {
			font-size: 0.7rem;
			font-weight: 600;
			padding: 0.2rem 0.6rem;
			background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
			color: white;
			border-radius: 10px;
			box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
			text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
			text-decoration: none;
			transition: all 0.15s ease;
		}
		a.jj-workspace-badge {
			cursor: pointer;
		}
		a.jj-workspace-badge:hover {
			background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
			transform: scale(1.05);
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
		}
		.jj-workspace-badge.current {
			background: linear-gradient(135deg, var(--pico-primary) 0%, color-mix(in srgb, var(--pico-primary) 80%, #000) 100%);
		}
		.jj-bookmark-badge {
			font-size: 0.65rem;
			font-weight: 500;
			padding: 0.15rem 0.45rem;
			background: var(--pico-muted-border-color);
			color: var(--pico-muted-color);
			border: none;
			border-radius: 4px;
		}
		.jj-timestamp {
			font-size: 0.75rem;
			color: var(--pico-muted-color);
		}
		.jj-description {
			margin: 0.25rem 0 0.15rem 0;
			color: var(--pico-color);
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			font-size: 0.875rem;
			line-height: 1.4;
		}
		.jj-description.empty {
			color: var(--pico-muted-color);
			font-style: italic;
			font-size: 0.8rem;
		}

		/* Tree panel styles - clean tree view */
		.workspace-item {
			margin-bottom: 0.1rem;
		}

		/* Expandable items with forks */
		.workspace-expandable {
			margin: 0;
			padding: 0;
			border: none;
		}
		.workspace-expandable summary {
			list-style: none;
		}
		.workspace-expandable summary::marker,
		.workspace-expandable summary::-webkit-details-marker {
			display: none;
			content: '';
		}
		.workspace-expandable summary::after {
			display: none !important;
			content: '' !important;
		}
		.workspace-expandable[open] summary::after {
			display: none !important;
			content: '' !important;
		}

		/* Header row for both expandable and leaf items */
		.workspace-header {
			display: flex;
			align-items: center;
			gap: 0;
			list-style: none;
			cursor: default;
		}
		.workspace-header::-webkit-details-marker {
			display: none;
		}
		.workspace-header::marker {
			display: none;
			content: '';
		}

		/* Toggle button for expandable items */
		.tree-toggle {
			width: 1.25rem;
			height: 1.25rem;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			border-radius: 4px;
			background: var(--pico-muted-border-color);
			color: var(--pico-muted-color);
			font-size: 0.75rem;
			font-weight: 600;
			flex-shrink: 0;
			cursor: pointer;
			transition: all 0.15s ease;
			margin-right: 0.35rem;
		}
		.tree-toggle::before {
			content: '+';
		}
		details[open] > .workspace-header .tree-toggle::before {
			content: '−';
		}
		.workspace-header:hover .tree-toggle {
			background: var(--pico-secondary);
			color: var(--pico-secondary-inverse);
		}

		/* Spacer for leaf items (no forks) - maintains alignment */
		.tree-spacer {
			width: 1.25rem;
			height: 1.25rem;
			display: inline-block;
			flex-shrink: 0;
			margin-right: 0.35rem;
		}

		/* Project link styling */
		.workspace-link {
			display: flex;
			align-items: center;
			gap: 0.35rem;
			flex: 1;
			min-width: 0;
			padding: 0.35rem 0.5rem;
			border-radius: 4px;
			text-decoration: none;
			color: inherit;
			transition: all 0.15s ease;
			position: relative;
			overflow: visible;
		}
		/* PicoCSS tooltips for workspace names - position to the right to avoid clipping */
		.tree-panel .workspace-name[data-tooltip] {
			position: relative;
		}
		.tree-panel .workspace-name[data-tooltip]::before,
		.tree-panel .workspace-name[data-tooltip]::after {
			z-index: 1000;
			white-space: nowrap;
		}
		.workspace-link:hover {
			background-color: color-mix(in srgb, var(--pico-muted-border-color) 60%, transparent);
		}
		.workspace-link.selected {
			background-color: var(--pico-primary-focus);
			border-left: 3px solid var(--pico-primary);
			padding-left: calc(0.5rem - 3px);
		}
		.workspace-link.selected .workspace-name {
			font-weight: 600;
			color: var(--pico-primary);
		}

		/* Children container with tree lines */
		.workspace-children {
			margin-left: calc(1.25rem / 2);
			padding-left: calc(1.25rem / 2 + 0.35rem + 0.5rem);
			position: relative;
		}
		.workspace-children::before {
			content: '';
			position: absolute;
			left: calc(1.25rem / 2);
			top: 0;
			bottom: 0.5rem;
			width: 2px;
			background: var(--pico-muted-border-color);
			border-radius: 1px;
		}

		/* Child item (fork) styling */
		.workspace-child {
			display: flex;
			align-items: center;
			gap: 0.35rem;
			padding: 0.3rem 0.5rem;
			border-radius: 4px;
			cursor: pointer;
			transition: all 0.15s ease;
			text-decoration: none;
			color: inherit;
			position: relative;
		}
		.workspace-child::before {
			content: '';
			position: absolute;
			left: calc(-1.25rem / 2 - 0.35rem - 0.5rem + 1.25rem / 2);
			top: 50%;
			width: calc(0.35rem + 0.5rem);
			height: 2px;
			background: var(--pico-muted-border-color);
			border-radius: 1px;
		}
		.workspace-child:hover {
			background-color: color-mix(in srgb, var(--pico-muted-border-color) 60%, transparent);
		}
		.workspace-child.selected {
			background-color: var(--pico-primary-focus);
			border-left: 3px solid var(--pico-primary);
			padding-left: calc(0.5rem - 3px);
		}
		.workspace-child.selected .workspace-name {
			font-weight: 600;
			color: var(--pico-primary);
		}

		/* Project name with ellipsis */
		.workspace-name {
			flex: 1;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			font-size: 0.875rem;
		}

		/* Trees status bar with pill and text */
		.trees-status-bar {
			display: flex;
			align-items: flex-start;
			gap: 0.75rem;
			margin-bottom: 0.5rem;
			flex-wrap: nowrap;
			max-width: 100%;
		}
		.trees-status {
			flex: 1;
			min-width: 0;
			font-size: 0.875rem;
			color: var(--pico-muted-color);
			padding: 0.5rem 0.75rem;
			background: color-mix(in srgb, var(--pico-muted-border-color) 30%, transparent);
			border-radius: 6px;
			overflow: visible;
			display: block;
			max-width: 100%;
			box-sizing: border-box;
			white-space: normal;
			word-break: break-word;
			overflow-wrap: break-word;
		}

		/* Sticky header container - keeps header, status, and tabs fixed at top */
		.sticky-header-container {
			position: sticky;
			top: 0;
			z-index: 100;
			background: var(--pico-background-color);
		}

		.workspace-header-bar {
			display: flex;
			align-items: center;
			gap: 0.75rem;
			margin-bottom: 0.75rem;
			padding-bottom: 0.75rem;
			border-bottom: 1px solid var(--pico-muted-border-color);
			flex-wrap: nowrap;
		}
		.workspace-title {
			margin: 0;
			font-size: 1.25rem;
			font-weight: 600;
			color: var(--pico-color);
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
			flex: 0 1 auto;
			min-width: 0;
			max-width: fit-content;
		}
		/* Header actions container - buttons inline with title */
		#header-actions {
			display: flex;
			align-items: center;
			gap: 0.35rem;
			flex-shrink: 0;
			margin: 0;
			padding: 0;
			margin-left: auto;
		}
		.header-actions-container {
			display: flex;
			align-items: center;
			gap: 0.35rem;
			flex-wrap: nowrap;
		}
		.header-actions-container form {
			display: inline-flex;
			margin: 0;
			padding: 0;
		}
		.action-btn {
			margin: 0 !important;
			padding: 0.35rem 0.6rem !important;
			font-size: 0.75rem !important;
			white-space: nowrap;
			display: inline-block;
			vertical-align: middle;
			line-height: 1.2;
		}
		.action-btn.attention {
			background-color: var(--pico-del-color);
			border-color: var(--pico-del-color);
			color: white;
		}
		.action-btn.attention:hover {
			background-color: color-mix(in srgb, var(--pico-del-color) 85%, black);
			border-color: color-mix(in srgb, var(--pico-del-color) 85%, black);
		}

	/* Tab nav styles */
	.tab-nav {
		padding-left: 10px;
		margin-bottom: 0;
		border-bottom: 1px solid var(--pico-muted-border-color);
		overflow-x: auto;
		overflow-y: hidden;
	}
	.tab-nav ul {
		margin-bottom: 0;
		white-space: nowrap;
		min-width: min-content;
	}
	.tab-nav a {
		color: var(--pico-muted-color);
		text-decoration: none;
		padding: 0.5rem 1rem;
		display: inline-block;
		border-bottom: 2px solid transparent;
		transition: all 0.15s ease;
	}
	.tab-nav a:hover {
		color: var(--pico-color);
	}
	.tab-nav a.active {
		color: var(--pico-primary);
		border-bottom-color: var(--pico-primary);
	}




		/* Execution timer styles */
		.execution-timer {
			font-size: 0.8rem;
			font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
			padding: 0.35rem 0.6rem;
			background: color-mix(in srgb, var(--pico-muted-border-color) 40%, transparent);
			border-radius: 4px;
			color: var(--pico-muted-color);
			flex-shrink: 0;
			white-space: nowrap;
		}

		/* Status badge styles */
		.status-badge {
			font-size: 0.75rem;
			line-height: 1 !important;
			padding: 0.5rem 0.5rem 0.4rem 0.5rem;
			background: color-mix(in srgb, var(--pico-muted-border-color) 50%, transparent);
			border-radius: 4px;
			color: var(--pico-muted-color);
			flex-shrink: 0;
			align-self: flex-start;
		}
		.status-badge.running {
			background: color-mix(in srgb, var(--pico-primary) 20%, transparent);
			color: var(--pico-primary);
		}

		/* Status text bar - below header */
		.status-text-bar {
			margin-bottom: 0.5rem;
		}
		.status-text-bar:empty {
			display: none;
		}

		/* Agent pill badge */
		.agent-pill {
			display: inline-block;
			font-size: 0.7rem;
			font-weight: 600;
			padding: 0.2rem 0.6rem;
			background: linear-gradient(135deg, var(--pico-primary) 0%, color-mix(in srgb, var(--pico-primary) 80%, #000) 100%);
			color: white;
			border-radius: 10px;
			margin-right: 0.5rem;
			vertical-align: middle;
			white-space: nowrap;
			cursor: help;
		}

		/* Multi-model consensus bar - header display */
		.model-consensus-bar {
			display: flex;
			flex-wrap: wrap;
			gap: 0.5rem;
			align-items: center;
			margin-top: 0.35rem;
		}
		.model-status-pill {
			display: inline-flex;
			align-items: center;
			gap: 0.25rem;
			font-size: 0.7rem;
			padding: 0.15rem 0.5rem;
			background: color-mix(in srgb, var(--pico-muted-border-color) 40%, transparent);
			border-radius: 10px;
			color: var(--pico-muted-color);
			white-space: nowrap;
			cursor: help;
		}
		.model-status-pill[data-tooltip*="model-working"] {
			background: color-mix(in srgb, var(--pico-primary) 15%, transparent);
			color: var(--pico-primary);
		}
		.model-status-pill[data-tooltip*="model-done"] {
			background: color-mix(in srgb, #22c55e 15%, transparent);
			color: #16a34a;
		}
		.model-status-pill[data-tooltip*="model-error"] {
			background: color-mix(in srgb, #ef4444 15%, transparent);
			color: #dc2626;
		}

		/* Multi-model statuses - workflow/progress display */
		.model-statuses {
			margin: 0.75rem 0;
			padding: 0.75rem;
			background: color-mix(in srgb, var(--pico-muted-border-color) 20%, transparent);
			border-radius: 6px;
			border: 1px solid var(--pico-muted-border-color);
		}
		.model-statuses strong {
			display: block;
			margin-bottom: 0.5rem;
			font-size: 0.8rem;
			color: var(--pico-muted-color);
			text-transform: uppercase;
			letter-spacing: 0.03em;
		}
		.model-statuses ul {
			list-style: none !important;
			margin: 0 !important;
			padding: 0 !important;
		}
		.model-statuses li {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.35rem 0;
			font-size: 0.85rem;
			border-bottom: 1px solid color-mix(in srgb, var(--pico-muted-border-color) 50%, transparent);
		}
		.model-statuses li:last-child {
			border-bottom: none;
		}
		.model-statuses li span:first-child {
			font-size: 0.9rem;
			width: 1rem;
			text-align: center;
			flex-shrink: 0;
		}
		.model-statuses li span[data-tooltip] {
			flex: 1;
			min-width: 0;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			text-decoration: none !important;
			border-bottom: none !important;
			cursor: help;
		}
		/* Remove PicoCSS tooltip underlines from model-related elements */
		.model-statuses [data-tooltip],
		.model-consensus-bar [data-tooltip],
		p > span[data-tooltip] {
			text-decoration: none !important;
			border-bottom: none !important;
		}
		.model-statuses li small {
			font-size: 0.7rem;
			color: var(--pico-muted-color);
			flex-shrink: 0;
		}

		/* Status indicator in messages container */
		.status-indicator {
			margin-bottom: 0.5rem;
		}

		/* Log lines styling - direct output without container */
		.log-lines {
			font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
			font-size: 0.8rem;
			line-height: 1.4;
			white-space: pre-wrap;
			word-break: break-all;
		}
		.log-line {
			padding: 0.1rem 0;
			border-bottom: 1px solid color-mix(in srgb, var(--pico-muted-border-color) 30%, transparent);
		}
		.log-line:last-child {
			border-bottom: none;
		}

		/* Tab content area */
		.tab-content {
			padding-top: 1rem;
		}

		/* Messages container grid - mirrors session.html styles */
		.tab-content .grid {
			display: grid;
			grid-template-columns: minmax(150px, 280px) 1fr;
			align-items: flex-start;
			gap: 1rem;
		}

		.tab-content .grid > article {
			align-self: flex-start;
			padding: 0.5rem;
			margin-bottom: 0;
		}

		.tab-content .grid > article > div {
			margin-top: 0;
			margin-bottom: 0;
			padding-top: 0.5rem;
		}

		.tab-content .grid > article > header {
			margin-bottom: 0.5rem;
			padding-bottom: 0.25rem;
		}

		/* Agent sequence list - only direct ol children of article, not in nested details */
		.tab-content .grid > article > ol {
			margin-top: 0;
			margin-bottom: 0;
			padding-left: 0.25rem;
			list-style: none;
		}

		.tab-content .grid > article > ol > li {
			word-break: break-word;
			hyphens: auto;
			font-size: 0.85rem;
			padding: 0.15rem 0;
			line-height: 1.3;
			display: flex;
			justify-content: space-between;
			gap: 0.5ch;
		}

		.tab-content .grid > article > ol > li .agent-name {
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			flex: 1;
			min-width: 0;
		}

		.tab-content .grid > article > ol > li .agent-time {
			flex-shrink: 0;
			white-space: nowrap;
		}

		.tab-content details {
			margin-bottom: 0.25rem;
			margin-top: 0;
			padding: 0;
			border: 1px solid var(--pico-muted-border-color);
			border-radius: 0.25rem;
		}

		.tab-content details + details {
			margin-top: 0.25rem;
		}

		.tab-content summary {
			padding: 0.5rem 0.75rem;
			padding-bottom: 0.25rem;
			margin-bottom: 0;
			white-space: normal;
			cursor: pointer;
		}

		.tab-content details[open] > div {
			padding: 0 0.75rem 0.5rem 0.75rem;
			margin-top: 0;
			background-color: var(--pico-card-background-color);
			white-space: normal;
			font-size: 0.9rem;
		}

		.tab-content .msg-subject {
			flex: 1;
			min-width: 0;
			font-size: 0.85rem;
			color: var(--pico-muted-color);
			margin-left: 0.5rem;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}

		/* Message body content styles - proper list rendering */
		.msg-body-content {
			font-size: 0.9rem;
			line-height: 1.5;
		}
		.msg-body-content h1,
		.msg-body-content h2,
		.msg-body-content h3,
		.msg-body-content h4 {
			margin-top: 0.75rem;
			margin-bottom: 0.5rem;
		}
		.msg-body-content h2 {
			font-size: 1.1rem;
		}
		.msg-body-content p {
			margin-bottom: 0.5rem;
		}
		.msg-body-content ul,
		.msg-body-content ol {
			margin: 0.5rem 0;
			padding-left: 1.5rem;
		}
		.msg-body-content ul {
			list-style-type: disc;
		}
		.msg-body-content ol {
			list-style-type: decimal;
		}
		.msg-body-content li {
			display: list-item;
			margin-bottom: 0.25rem;
			padding-left: 0.25rem;
		}
		.msg-body-header {
			font-size: 0.85rem;
			color: var(--pico-muted-color);
			margin-bottom: 0.25rem;
		}

		/* Specification box styles */
		#specification-container {
			margin-bottom: 1rem;
			padding: 0;
		}
		#specification-container details {
			margin: 0;
			padding: 0;
			border: 1px solid var(--pico-muted-border-color);
			border-radius: 0.25rem;
		}
		#specification-container summary {
			padding: 0.75rem 1rem;
			cursor: pointer;
			background-color: color-mix(in srgb, var(--pico-muted-border-color) 30%, transparent);
		}
		#specification-container details[open] summary {
			border-bottom: 1px solid var(--pico-muted-border-color);
		}
		.specification-content {
			padding: 1rem;
			font-size: 0.9rem;
			line-height: 1.6;
			max-height: 300px;
			overflow-y: auto;
		}
		.specification-content h1,
		.specification-content h2,
		.specification-content h3 {
			margin-top: 0.5rem;
			margin-bottom: 0.5rem;
		}
		.specification-content h1 { font-size: 1.2rem; }
		.specification-content h2 { font-size: 1.1rem; }
		.specification-content h3 { font-size: 1rem; }
		.specification-content ul,
		.specification-content ol {
			margin: 0.5rem 0;
			padding-left: 1.5rem;
		}
		.specification-content li {
			margin-bottom: 0.25rem;
		}

		/* Specification tab content - full page height foldables */
		.specification-tab-content {
			display: flex;
			flex-direction: column;
			gap: 1rem;
		}
		.spec-foldable {
			margin: 0;
			padding: 0;
			border: 1px solid var(--pico-muted-border-color);
			border-radius: 0.5rem;
			/* overflow: hidden; Removed to allow tooltips to show */
		}
		.spec-foldable summary {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.75rem 1rem;
			cursor: pointer;
			background-color: color-mix(in srgb, var(--pico-muted-border-color) 30%, transparent);
			border-radius: 0.5rem;
			list-style: none;
		}
		.spec-foldable summary::-webkit-details-marker,
		.spec-foldable summary::marker {
			display: none;
			content: "";
		}
		.spec-foldable summary::after {
			display: none;
		}
		.spec-foldable summary::before {
			content: "▶";
			font-size: 0.7rem;
			transition: transform 0.2s ease;
			flex-shrink: 0;
		}
		.spec-foldable[open] summary::before {
			transform: rotate(90deg);
		}
		.spec-foldable[open] summary {
			border-radius: 0.5rem 0.5rem 0 0;
			border-bottom: 1px solid var(--pico-muted-border-color);
		}
		.spec-foldable summary strong {
			flex-grow: 1;
		}
		.spec-content {
			padding: 1rem 1.5rem;
			font-size: 0.9rem;
			line-height: 1.6;
		}
		.spec-content h1,
		.spec-content h2,
		.spec-content h3 {
			margin-top: 1rem;
			margin-bottom: 0.5rem;
		}
		.spec-content h1:first-child,
		.spec-content h2:first-child,
		.spec-content h3:first-child {
			margin-top: 0;
		}
		.spec-content h1 { font-size: 1.3rem; }
		.spec-content h2 { font-size: 1.15rem; }
		.spec-content h3 { font-size: 1rem; }
		.spec-content p {
			margin-bottom: 0.75rem;
		}
		.spec-content ul,
		.spec-content ol {
			margin: 0.5rem 0;
			padding-left: 1.5rem;
		}
		.spec-content ul {
			list-style-type: disc;
		}
		.spec-content ol {
			list-style-type: decimal;
		}
		.spec-content li {
			display: list-item;
			margin-bottom: 0.25rem;
			padding-left: 0.25rem;
		}
		.spec-content code {
			font-size: 0.85em;
			padding: 0.15rem 0.35rem;
			background: color-mix(in srgb, var(--pico-muted-border-color) 50%, transparent);
			border-radius: 3px;
		}
		.spec-content pre {
			padding: 1rem;
			background: color-mix(in srgb, var(--pico-muted-border-color) 30%, transparent);
			border-radius: 4px;
			overflow-x: auto;
		}
		.spec-content pre code {
			padding: 0;
			background: none;
		}

		/* VSCode file button styles */
		.spec-vscode-form {
			display: inline-flex;
			margin: 0;
			padding: 0;
			flex-shrink: 0;
		}
		.vscode-file-btn {
			background: none;
			border: none;
			padding: 0.15rem 0.3rem;
			cursor: pointer;
			font-size: 0.9rem;
			line-height: 1;
			color: var(--pico-muted-color);
			transition: all 0.15s ease;
			vertical-align: middle;
			position: relative;
		}
		.vscode-file-btn:hover {
			color: var(--pico-primary);
			transform: scale(1.1);
		}
		.vscode-file-btn.disabled {
			opacity: 0.4;
			cursor: not-allowed;
		}
		/* Ensure tooltips on vscode-file-btn are visible */
		.vscode-file-btn[data-tooltip]::before,
		.vscode-file-btn[data-tooltip]::after {
			z-index: 1000;
		}

		/* Terminal editor path display */
		.terminal-editor-path {
			display: inline-flex;
			flex-direction: column;
			gap: 0.25rem;
			margin: 0;
			padding: 0.25rem 0.5rem;
			flex-shrink: 0;
		}
		.terminal-editor-path small {
			font-size: 0.65rem;
			color: var(--pico-muted-color);
			margin: 0;
		}
		.terminal-editor-path .path-input {
			cursor: text;
			user-select: all;
			font-family: monospace;
			font-size: 0.75rem;
			padding: 0.25rem 0.5rem;
			margin: 0;
			width: 100%;
			min-width: 300px;
			background: var(--pico-form-element-background-color);
			border: 1px solid var(--pico-form-element-border-color);
			border-radius: 0.25rem;
		}
		.terminal-editor-path .path-input:focus {
			outline: 2px solid var(--pico-primary);
			outline-offset: 0;
		}

		/* Terminal editor workspace path in header actions */
		.terminal-editor-workspace-path {
			display: inline-flex;
			flex-direction: column;
			gap: 0.25rem;
			padding: 0.25rem 0.5rem;
		}
		.terminal-editor-workspace-path small {
			font-size: 0.65rem;
			color: var(--pico-muted-color);
			margin: 0;
		}
		.terminal-editor-workspace-path .path-input {
			cursor: text;
			user-select: all;
			font-family: monospace;
			font-size: 0.75rem;
			padding: 0.25rem 0.5rem;
			margin: 0;
			min-width: 300px;
			background: var(--pico-form-element-background-color);
			border: 1px solid var(--pico-form-element-border-color);
			border-radius: 0.25rem;
		}
		.terminal-editor-workspace-path .path-input:focus {
			outline: 2px solid var(--pico-primary);
			outline-offset: 0;
		}

		/* Workflow container styles - mirrors session.html */
		.tab-content #workflow-container ul {
			list-style: none !important;
			padding-left: 0 !important;
			margin-left: 0 !important;
		}

		.tab-content #workflow-container ul li {
			list-style-type: none !important;
			padding-left: 0 !important;
			margin-left: 0 !important;
		}

		.tab-content #workflow-container ul li::marker {
			content: none !important;
			display: none !important;
		}

		.tab-content #workflow-container ul li::before {
			content: none !important;
			display: none !important;
		}

		.tab-content #workflow-container > div {
			display: flex;
			gap: 1rem;
		}

		.tab-content #workflow-container > div > div {
			flex: 1;
		}


		/* Workspace status indicators */
		.workspace-spinner {
			color: var(--pico-primary);
			animation: spin 1s linear infinite;
			margin-left: 0.25rem;
			font-size: 0.9rem;
		}
		@keyframes spin {
			from { transform: rotate(0deg); }
			to { transform: rotate(360deg); }
		}
		.workspace-attention {
			color: var(--pico-del-color);
			margin-left: 0.25rem;
			font-size: 0.6rem;
			vertical-align: middle;
		}

		/* Tree panel footer - fixed button at bottom */
		.tree-panel-footer-spacer {
			height: 3.75rem;
			pointer-events: none;
		}
		.tree-panel-footer {
			position: sticky;
			bottom: 0;
			padding: 0.5rem;
			background: var(--pico-background-color);
			border-top: 1px solid var(--pico-muted-border-color);
		}
		.new-workspace-btn {
			width: 100%;
			margin: 0;
		}

		/* In Progress section styles */
		.in-progress-section {
			margin-bottom: 0.75rem;
			padding-bottom: 0.5rem;
			border-bottom: 1px solid var(--pico-muted-border-color);
		}
		.in-progress-header {
			font-size: 0.75rem;
			font-weight: 600;
			color: var(--pico-del-color);
			text-transform: uppercase;
			letter-spacing: 0.03em;
			margin-bottom: 0.35rem;
			display: flex;
			align-items: center;
			gap: 0.35rem;
		}
		.in-progress-header.no-attention {
			color: var(--pico-muted-color);
		}
		.in-progress-item {
			display: flex;
			align-items: center;
			gap: 0.35rem;
			padding: 0.3rem 0.5rem;
			margin-left: 0.5rem;
			border-radius: 4px;
			text-decoration: none;
			color: inherit;
			transition: all 0.15s ease;
			margin-bottom: 0.1rem;
		}
		.in-progress-item:hover {
			background-color: color-mix(in srgb, var(--pico-del-color) 15%, transparent);
		}
		.in-progress-item.selected {
			background-color: var(--pico-primary-focus);
			border-left: 3px solid var(--pico-primary);
			padding-left: calc(0.5rem - 3px);
		}
		.in-progress-item .workspace-name {
			flex: 1;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			font-size: 0.875rem;
		}
		.in-progress-item.selected .workspace-name {
			font-weight: 600;
			color: var(--pico-primary);
		}

		/* Retrospectives tab embedded styles */
		.retro-content-embedded {
			height: 100%;
		}
		.retro-split {
			display: flex;
			gap: 1.5rem;
			height: calc(100vh - 280px);
		}
		.retro-panel-embedded {
			width: 320px;
			min-width: 280px;
			max-width: 400px;
			overflow-y: auto;
			overflow-x: visible;
			border-right: 1px solid var(--pico-muted-border-color);
			padding-right: 1rem;
		}
		.retro-details-embedded {
			flex: 1;
			overflow: auto;
			padding-left: 1rem;
		}
		.retro-session-item {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			width: 100%;
			padding: 0.5rem 0.75rem;
			margin-bottom: 0.25rem;
			border-radius: 6px;
			cursor: pointer;
			text-decoration: none;
			color: inherit;
			transition: all 0.15s ease;
			background-color: transparent;
			border: 1px solid var(--pico-muted-border-color);
			text-align: left;
		}
		.retro-session-item:hover {
			background-color: color-mix(in srgb, var(--pico-muted-border-color) 60%, transparent);
			border-color: var(--pico-muted-border-color);
		}
		.retro-session-item.selected {
			background-color: var(--pico-primary-focus);
			border-left: 3px solid var(--pico-primary);
			border-color: var(--pico-primary);
			padding-left: calc(0.75rem - 3px);
		}
		.retro-session-item.selected .session-name {
			font-weight: 600;
			color: var(--pico-primary);
		}
		.session-name {
			flex: 1;
			min-width: 0;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			font-size: 0.875rem;
		}
		.session-indicator {
			width: 8px;
			height: 8px;
			border-radius: 50%;
			background: var(--pico-muted-border-color);
			flex-shrink: 0;
		}
		.session-indicator.analyzed {
			background: var(--pico-primary);
		}
		.retro-header {
			display: flex;
			align-items: center;
			gap: 1rem;
			margin-bottom: 1rem;
			flex-wrap: wrap;
		}
		.retro-header h4 {
			margin: 0;
			flex: 1;
			min-width: 0;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		.retro-status {
			font-size: 0.75rem;
			padding: 0.25rem 0.5rem;
			border-radius: 4px;
			background: color-mix(in srgb, var(--pico-muted-border-color) 50%, transparent);
			color: var(--pico-muted-color);
			flex-shrink: 0;
			white-space: nowrap;
		}
		.retro-status.analyzed {
			background: color-mix(in srgb, var(--pico-primary) 20%, transparent);
			color: var(--pico-primary);
		}
		.retro-actions {
			display: flex;
			gap: 0.5rem;
			margin-bottom: 1rem;
		}
		.retro-actions button,
		.retro-actions a[role="button"] {
			margin: 0;
			padding: 0.5rem 1rem;
			font-size: 0.875rem;
		}
		.retro-content-section {
			margin-bottom: 1.5rem;
		}
		.retro-content-section h5 {
			margin-bottom: 0.5rem;
			color: var(--pico-muted-color);
			font-size: 0.875rem;
			text-transform: uppercase;
			letter-spacing: 0.05em;
		}
		.retro-content-section article {
			padding: 1rem;
			margin: 0;
		}
		.empty-state {
			padding: 2rem;
			text-align: center;
			color: var(--pico-muted-color);
			font-style: italic;
		}

		/* Remove inline margin from forms in retro-actions */
		.retro-actions form {
			margin: 0;
		}

		/* Retro panel tooltips - hide by default, show on hover */
		.retro-panel-embedded [data-tooltip]::before,
		.retro-panel-embedded [data-tooltip]::after {
			opacity: 0 !important;
			visibility: hidden !important;
			pointer-events: none !important;
		}
		.retro-panel-embedded [data-tooltip]:hover::before,
		.retro-panel-embedded [data-tooltip]:hover::after {
			opacity: 1 !important;
			visibility: visible !important;
		}

		/* Cost Tracking styles */
		#cost-container {
			margin-bottom: 1rem;
		}
		#cost-container > header {
			margin-bottom: 0.5rem;
		}
		.cost-summary-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
			gap: 0.5rem;
			margin-bottom: 0.75rem;
		}
		.cost-summary-grid > div {
			padding: 0.5rem;
			background: color-mix(in srgb, var(--pico-muted-border-color) 30%, transparent);
			border-radius: 6px;
			text-align: center;
		}
		.cost-summary-grid > div small {
			color: var(--pico-muted-color);
			font-size: 0.75rem;
		}
		.cost-summary-grid > div strong {
			font-size: 0.95rem;
			color: var(--pico-color);
		}
		#cost-container details {
			margin: 0;
			padding: 0;
			border: 1px solid var(--pico-muted-border-color);
			border-radius: 0.25rem;
		}
		#cost-container details + details {
			margin-top: 0.25rem;
		}
		#cost-container details > summary {
			padding: 0.5rem 0.75rem;
			cursor: pointer;
			font-size: 0.875rem;
		}
		#cost-container details[open] > summary {
			border-bottom: 1px solid var(--pico-muted-border-color);
		}
		.cost-agents {
			padding: 0.5rem;
		}
		.cost-agents details {
			background: color-mix(in srgb, var(--pico-muted-border-color) 20%, transparent);
		}
		.cost-agent-summary {
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}
		.cost-agent-name {
			flex: 1;
			min-width: 0;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		.cost-agent-value {
			font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
			font-size: 0.85rem;
			color: var(--pico-primary);
			flex-shrink: 0;
		}
		.cost-steps {
			padding: 0.5rem;
			display: flex;
			flex-direction: column;
			gap: 0.25rem;
		}
		.cost-step {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.25rem 0.5rem;
			background: color-mix(in srgb, var(--pico-muted-border-color) 30%, transparent);
			border-radius: 4px;
			font-size: 0.8rem;
		}
		.cost-step-id {
			flex: 1;
			min-width: 0;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			color: var(--pico-muted-color);
		}
		.cost-step-value {
			font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
			font-size: 0.75rem;
			flex-shrink: 0;
		}
		.cost-step-tokens {
			color: var(--pico-muted-color);
			flex-shrink: 0;
		}

		/* Ad-hoc prompt styles */
		#adhoc-prompt-container {
			margin-top: 1rem;
		}
		#adhoc-prompt-container .grid {
			margin-bottom: 0.5rem;
		}
		#adhoc-prompt-container button[type="submit"] {
			width: 100%;
		}
		.adhoc-output {
			font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
			white-space: pre-wrap;
			word-wrap: break-word;
			max-height: 400px;
			overflow-y: auto;
			background: var(--pico-code-background-color);
			padding: 1rem;
			border-radius: var(--pico-border-radius);
			font-size: 0.85em;
			margin: 0 0 0.5rem 0;
			min-height: 2rem;
		}
		.adhoc-output:empty {
			display: none;
		}

		/* Sequence container */
		#sequence-container article {
			padding: 0.5rem;
			margin-bottom: 0;
		}
		#sequence-container article > header {
			margin-bottom: 0.5rem;
			padding-bottom: 0.25rem;
		}
		#sequence-container ol {
			margin-top: 0;
			margin-bottom: 0;
			padding-left: 0.25rem;
			list-style: none;
		}
		#sequence-container ol > li {
			word-break: break-word;
			hyphens: auto;
			font-size: 0.85rem;
			padding: 0.15rem 0;
			line-height: 1.3;
			display: flex;
			justify-content: space-between;
			gap: 0.5ch;
		}
		#sequence-container ol > li .agent-name {
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			flex: 1;
			min-width: 0;
		}
		#sequence-container ol > li .agent-time {
			flex-shrink: 0;
			white-space: nowrap;
		}

		/* Modal dialog styles */
		#modal-dialog {
			width: min(90vw, 800px);
			max-height: 90vh;
			padding: 0;
			border: none;
			border-radius: 8px;
			box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
		}
		#modal-dialog::backdrop {
			background: rgba(0, 0, 0, 0.5);
		}
		#modal-dialog article {
			margin: 0;
			padding: 1.5rem;
			max-height: 90vh;
			overflow-y: auto;
		}
		#modal-dialog article header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 1rem;
			padding-bottom: 0.75rem;
			border-bottom: 1px solid var(--pico-muted-border-color);
		}
		#modal-dialog article header h3 {
			margin: 0;
		}
		#modal-dialog .modal-close {
			background: none;
			border: none;
			padding: 0.25rem 0.5rem;
			cursor: pointer;
			font-size: 1.5rem;
			color: var(--pico-muted-color);
			line-height: 1;
		}
		#modal-dialog .modal-close:hover {
			color: var(--pico-color);
		}
		#modal-dialog textarea {
			min-height: 200px;
		}

		/* Diff viewer styles */
		.diff-viewer {
			overflow: hidden;
		}
		.diff-content {
			font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
			font-size: 0.75rem;
			line-height: 1.3;
			overflow-x: auto;
			padding: 0;
			margin: 0;
			background: var(--pico-card-background-color);
			border-radius: 0.25rem;
		}
		.diff-content pre {
			margin: 0;
			padding: 0;
			background: transparent;
			overflow: visible;
		}
		.diff-line {
			display: block;
			padding: 0 0.5rem;
			white-space: pre;
			border-left: 3px solid transparent;
		}
		.diff-line-add {
			background: color-mix(in srgb, #22c55e 15%, transparent);
			border-left-color: #22c55e;
			color: #166534;
		}
		.diff-line-del {
			background: color-mix(in srgb, #ef4444 15%, transparent);
			border-left-color: #ef4444;
			color: #991b1b;
		}
		.diff-line-hunk {
			background: color-mix(in srgb, #3b82f6 10%, transparent);
			color: #1d4ed8;
			font-weight: 600;
			padding: 0 0.5rem;
			margin-top: 0;
		}
		.diff-line-hunk:first-child {
			margin-top: 0;
		}
		.diff-line-file {
			background: color-mix(in srgb, var(--pico-muted-border-color) 40%, transparent);
			color: var(--pico-color);
			font-weight: 600;
			padding: 0 0.5rem;
			margin-top: 0.25rem;
			border-radius: 4px 4px 0 0;
		}
		.diff-line-file:first-child {
			margin-top: 0;
		}
		.diff-line-context {
			color: var(--pico-muted-color);
		}

		/* Mobile responsiveness */
		@media (max-width: 768px) {
			.tree-container {
				flex-direction: column;
				height: auto;
			}
			.tree-panel {
				width: 100%;
				max-width: none;
				border-right: none;
				border-bottom: 1px solid var(--pico-muted-border-color);
				padding-right: 0;
				padding-left: 0.5rem;
				padding-bottom: 1rem;
				max-height: 40vh;
				overflow-y: auto;
			}
			.log-panel {
				padding-left: 0;
				padding-top: 1rem;
			}
			/* Header actions responsive - allow wrapping */
			.workspace-header-bar {
				flex-wrap: wrap;
			}
			.workspace-title {
				max-width: 100%;
			}
			.workspace-header-bar .trees-status-bar {
				max-width: 100%;
				flex: 1 1 100%;
				order: 3;
			}
			#header-actions {
				flex: 1 1 auto;
				justify-content: flex-end;
				margin-left: 0;
			}
			.header-actions-container {
				flex-wrap: wrap;
				justify-content: flex-end;
			}
			/* Stack sequence and messages boxes on mobile */
			.tab-content .grid {
				grid-template-columns: 1fr;
			}
			.tab-content .grid > article {
				width: 100%;
			}
			/* Make tab navigation scroll horizontally on narrow screens */
			.tab-nav ul {
				overflow-x: auto;
				flex-wrap: nowrap;
				-webkit-overflow-scrolling: touch;
			}
			.tab-nav a {
				white-space: nowrap;
			}
			/* Status bar adjustments for mobile - keep horizontal layout */
			.trees-status-bar {
				flex-direction: row;
				align-items: flex-start;
				gap: 0.5rem;
				flex-wrap: nowrap;
			}
			.trees-status {
				max-width: 100%;
				flex: 1;
			}
			/* Stack workflow SVG and TODOs vertically on mobile */
			.tab-content #workflow-container > div {
				flex-direction: column;
			}
			/* Retrospectives split layout - stack on mobile */
			.retro-split {
				flex-direction: column;
				height: auto;
			}
			.retro-panel-embedded {
				width: 100%;
				max-width: none;
				border-right: none;
				border-bottom: 1px solid var(--pico-muted-border-color);
				padding-right: 0;
				padding-bottom: 1rem;
				max-height: 30vh;
			}
			.retro-details-embedded {
				padding-left: 0;
				padding-top: 1rem;
			}
		}

		/* TODOs grid styles */
		.todos-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 1.5rem;
		}
		.todos-column ul {
			list-style: none !important;
			padding-left: 0 !important;
			margin-left: 0 !important;
		}
		.todos-column li {
			list-style-type: none !important;
			padding-left: 0 !important;
			margin-left: 0 !important;
			margin-bottom: 0.35rem;
			font-size: 0.85rem;
			line-height: 1.4;
			display: flex;
			gap: 0.5rem;
		}
		.todos-column li span:first-child {
			flex-shrink: 0;
			font-family: monospace;
		}
		.human-message-container {
			margin-bottom: 1rem;
		}

		/* Mobile responsiveness for TODOs */
		@media (max-width: 768px) {
			.todos-grid {
				grid-template-columns: 1fr;
				gap: 1rem;
			}
		}
	</style>
</head>
<body hx-ext="morph">
	<main class="container-fluid">
		<div class="tree-container" hx-get="/trees/refresh{{if .SelectedDir}}?workspace={{.SelectedDir}}{{end}}{{if .SelectedTab}}{{if .SelectedDir}}&amp;{{else}}?{{end}}tab={{.SelectedTab}}{{end}}{{if .SelectedSession}}{{if or .SelectedDir .SelectedTab}}&amp;{{else}}?{{end}}session={{.SelectedSession}}{{end}}" hx-trigger="every 2s [document.activeElement.id!='commit-description' && document.activeElement.id!='adhoc-prompt']" hx-swap="morph:innerHTML">
{{ template "trees_content.html" . }}
		</div>
	</main>
	<script>
	/* Idiomorph configuration: preserve details open state and active element focus/value */
	Idiomorph.defaults.ignoreActive = true;
	Idiomorph.defaults.ignoreActiveValue = true;
	Idiomorph.defaults.callbacks.beforeAttributeUpdated = function(attr, node) {
		if (attr === 'open' && node.tagName === 'DETAILS') return false;
	};
	Idiomorph.defaults.callbacks.beforeNodeMorphed = function(oldNode, newNode) {
		if (oldNode.id === 'adhoc-prompt-container') return false;
		return true;
	};
	/* Idiomorph integration: preserve scroll positions during morph swaps */
	(function() {
		var scrollState = {}, selectors = '.tree-panel, .log-panel, .retro-panel-embedded';
		var adhocScrollState = {};
		document.body.addEventListener('htmx:beforeSwap', function() {
			scrollState = {};
			document.querySelectorAll(selectors).forEach(function(el, i) { scrollState[i] = el.scrollTop; });
			var adhocOutput = document.querySelector('.adhoc-output');
			if (adhocOutput) {
				var wasAtBottom = adhocOutput.scrollTop + adhocOutput.clientHeight >= adhocOutput.scrollHeight - 30;
				adhocScrollState = { scrollTop: adhocOutput.scrollTop, wasAtBottom: wasAtBottom };
			}
		});
		document.body.addEventListener('htmx:afterSwap', function() {
			document.querySelectorAll(selectors).forEach(function(el, i) {
				if (scrollState[i] !== undefined) el.scrollTop = scrollState[i];
			});
			var adhocOutput = document.querySelector('.adhoc-output');
			if (adhocOutput && adhocScrollState.wasAtBottom !== undefined) {
				if (adhocScrollState.wasAtBottom) {
					adhocOutput.scrollTop = adhocOutput.scrollHeight;
				} else {
					adhocOutput.scrollTop = adhocScrollState.scrollTop;
				}
			}
		});
	})();
	</script>
</body>
</html>
