<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="color-scheme" content="light">
	<title>GOAL.md Composer - Step {{.Step}} - {{.DirName}}</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
	<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js" integrity="sha384-/TgkGk7p307TH7EXJDuUlgG3Ce1UVolAOFopFekQkkXihi5u/6OCvVKyz1W+idaz" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/idiomorph@0.3.0/dist/idiomorph-ext.min.js"></script>
	<style>
		html, body { height: 100%; margin: 0; }
		body { display: flex; flex-direction: column; }
		main.container-fluid { flex: 1; display: flex; flex-direction: column; padding: 1rem; overflow: hidden; }
		.wizard-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--pico-muted-border-color); }
		.wizard-header nav ul { margin: 0; }
		.progress-indicator { display: flex; gap: 0.5rem; align-items: center; }
		.progress-dot { width: 12px; height: 12px; border-radius: 50%; background-color: var(--pico-muted-border-color); }
		.progress-dot.active { background-color: var(--pico-primary); }
		.progress-dot.completed { background-color: var(--pico-primary); opacity: 0.6; }
		.wizard-layout { display: grid; grid-template-columns: 60% 40%; gap: 1.5rem; flex: 1; overflow: hidden; }
		.wizard-content { display: flex; flex-direction: column; overflow-y: auto; padding-right: 0.5rem; }
		.wizard-step { flex: 1; }
		.wizard-step h2 { margin-bottom: 0.5rem; }
		.wizard-step p.hint { color: var(--pico-muted-color); margin-bottom: 1.5rem; }
		.wizard-navigation { display: flex; justify-content: space-between; padding-top: 1rem; border-top: 1px solid var(--pico-muted-border-color); margin-top: auto; }
		.wizard-navigation button, .wizard-navigation a[role="button"] { margin: 0; }
		.preview-container { position: sticky; top: 0; align-self: start; max-height: calc(100vh - 150px); overflow-y: auto; border: 1px solid var(--pico-muted-border-color); border-radius: 0.5rem; background: var(--pico-card-background-color); }
		.preview-header { position: sticky; top: 0; background: var(--pico-card-background-color); padding: 1rem; border-bottom: 1px solid var(--pico-muted-border-color); z-index: 10; }
		.preview-header h3 { margin: 0; font-size: 1rem; }
		.preview-body { padding: 1rem; }
		.preview-content { font-size: 0.9rem; line-height: 1.6; overflow-wrap: break-word; word-break: break-word; }
		.flow-error { margin-top: 1rem; padding: 0.5rem; background: color-mix(in srgb, #ef4444 15%, transparent); color: #991b1b; border-left: 3px solid #ef4444; border-radius: 0.25rem; font-size: 0.85rem; }
		.option-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; }
		.option-card { padding: 1rem; border: 2px solid var(--pico-muted-border-color); border-radius: 0.5rem; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; min-width: 0; max-width: 100%; box-sizing: border-box; position: relative; }
		.option-label { font-weight: 600; text-align: center; display: block; min-width: 0; max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
		.option-card:hover { border-color: var(--pico-primary); }
		.option-card.selected { border-color: var(--pico-primary); background-color: color-mix(in srgb, var(--pico-primary) 10%, transparent); }
		.option-card input[type="checkbox"] { position: absolute; opacity: 0; width: 1px; height: 1px; overflow: hidden; clip: rect(0, 0, 0, 0); }
		.option-card:has(input:checked) { border-color: var(--pico-primary); background-color: color-mix(in srgb, var(--pico-primary) 10%, transparent); }
		.wizard-navigation a[role="button"], .wizard-navigation button { min-width: 120px; text-align: center; }
		@media (max-width: 768px) { .wizard-layout { grid-template-columns: 1fr; } .preview-container { max-height: none; } .option-grid { grid-template-columns: repeat(2, 1fr); } }
	</style>
</head>
<body hx-ext="morph">
	<main class="container-fluid">
		<div class="wizard-header">
			<nav>
				<ul>
					<li><a href="/compose?workspace={{.DirName}}">‚Üê Back to Templates</a></li>
				</ul>
			</nav>
			<div class="progress-indicator">
				{{range $i := seq 1 4}}
				<div class="progress-dot {{if lt $i $.Step}}completed{{else if eq $i $.Step}}active{{end}}"></div>
				{{end}}
			</div>
		</div>

		<div class="wizard-layout">
			<div class="wizard-content">
				<div class="wizard-step">
					<h2>Step 2: Tech Stack</h2>
					<p class="hint">Select the technologies you'll be using. Each choice automatically adds the right developer and reviewer agents.</p>

					<form hx-post="/compose/wizard/step/2?workspace={{.DirName}}"
					      hx-target="#compose-preview"
					      hx-swap="morph:innerHTML"
					      hx-trigger="change">
						<div class="option-grid">
							{{range .TechStackItems}}
						<label class="option-card" data-tooltip="{{.Name}}" data-placement="bottom">
							<input type="checkbox" name="techstack" value="{{.ID}}" {{if .Selected}}checked{{end}}>
							<div class="option-label">{{.Name}}</div>
						</label>
							{{end}}
						</div>
					</form>
				</div>

				<div class="wizard-navigation">
					<a href="/compose/wizard/step/1?workspace={{.DirName}}" role="button" class="secondary outline">‚Üê Back</a>
					<a href="/compose/wizard/step/3?workspace={{.DirName}}" role="button">Next ‚Üí</a>
				</div>

			</div>

			<div class="preview-container" id="compose-preview">
				<div class="preview-header">
					<h3>üìÑ GOAL.md Preview</h3>
				</div>
				<div class="preview-body">
					<div class="preview-content">
						{{.Preview}}
					</div>
					{{if .FlowError}}
					<div class="flow-error">
						‚ö†Ô∏è {{.FlowError}}
					</div>
					{{end}}
				</div>
			</div>
		</div>
	</main>

	<script>
		Idiomorph.defaults.ignoreActive = true;
		Idiomorph.defaults.ignoreActiveValue = true;
	</script>
</body>
</html>
