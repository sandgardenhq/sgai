{{if .Forks}}
<div class="forks-table-wrapper">
	<table class="forks-table">
		<thead>
			<tr>
				<th>Fork</th>
				<th>Status</th>
				<th>Commits Ahead</th>
				<th>Actions</th>
			</tr>
		</thead>
		<tbody>
			{{range .Forks}}
			<tr>
				<td>
					<span class="fork-name" data-tooltip="{{.DirName}}">{{.DirName}}</span>
				</td>
				<td>
					<span class="status-badge{{if .Running}} running{{end}}">{{if .Running}}running{{else}}stopped{{end}}</span>
				</td>
				<td class="fork-commit-count">{{.CommitAhead}}</td>
				<td>
					<div class="fork-actions">
						{{if $.EditorAvailable}}
							{{if $.IsTerminalEditor}}
							<div class="terminal-editor-workspace-path">
								<small>Workspace Path:</small>
								<input type="text" readonly value="{{.Directory}}" class="path-input">
							</div>
							{{else}}
							<form action="/workspaces/{{.DirName}}/open-vscode" method="post" style="display:inline">
								<button type="submit" class="action-btn outline">Open in Editor</button>
							</form>
							{{end}}
						{{else}}
						<button type="button" class="action-btn outline" disabled data-tooltip="Editor not available or remote connection">Open in Editor</button>
						{{end}}
						<a href="/trees?workspace={{.DirName}}" role="button" class="action-btn outline">Open in sgai</a>
						<details class="merge-confirmation">
							<summary><span class="action-btn outline">Merge</span></summary>
							<div class="merge-confirmation-panel">
								<p>This will rebase and squash the fork, create the PR, then delete the fork workspace.</p>
								<form action="/workspaces/{{$.RootDirName}}/merge" method="post">
									<input type="hidden" name="fork_dir" value="{{.Directory}}">
									<label class="merge-confirmation-check">
									<input type="checkbox" name="confirm_delete" value="true" required>
										I understand this deletes the fork workspace after merge.
									</label>
									<button type="submit" class="action-btn attention">Confirm merge</button>
								</form>
							</div>
						</details>
					</div>
				</td>
			</tr>
			<tr class="fork-commits-row">
				<td colspan="4">
					<div class="fork-commits">
						<div class="fork-commits-header">
							<span>Commits</span>
							<span class="fork-commit-count">{{.CommitAhead}} ahead</span>
						</div>
						{{if .Commits}}
						<ol class="fork-commit-list">
							{{range .Commits}}
							<li class="fork-commit">
								<div class="fork-commit-meta">
									<span class="fork-commit-ids" data-tooltip="{{.ChangeID}} {{.CommitID}}">
										<span class="fork-commit-id">{{.ChangeID}}</span>
										<span class="fork-commit-id">{{.CommitID}}</span>
									</span>
									<span class="fork-commit-time" data-tooltip="{{.Timestamp}}">{{.Timestamp}}</span>
									{{if .Bookmarks}}
									<span class="fork-commit-bookmarks" data-tooltip="{{range .Bookmarks}}{{.}} {{end}}">
										{{range .Bookmarks}}<span class="fork-commit-bookmark">{{.}}</span>{{end}}
									</span>
									{{end}}
								</div>
								<div class="fork-commit-description" data-tooltip="{{.Description}}">{{.Description}}</div>
							</li>
							{{end}}
						</ol>
						{{else}}
						<p class="fork-commit-empty"><em>No commits to display.</em></p>
						{{end}}
					</div>
				</td>
			</tr>
			{{end}}
		</tbody>
	</table>
</div>
{{else}}
<div class="forks-empty-state">
	<p>No forks yet. Create a fork to start work.</p>
</div>
{{end}}
